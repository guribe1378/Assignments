CREATE TABLE TIPO_VEHICULOS 
(
  ID_TIPO_VEH INTEGER NOT NULL
, DESC_TIPO_VEH VARCHAR2(60 BYTE) NOT NULL 
, CONSTRAINT TIPO_VEHICULO_PK PRIMARY KEY 
  (
    ID_TIPO_VEH 
  )
)

INSERT INTO TIPO_VEHICULOS VALUES ('1','Ciclomotor');
INSERT INTO TIPO_VEHICULOS VALUES ('2','Motocicleta');
INSERT INTO TIPO_VEHICULOS VALUES ('3','Motocicleta Trike');
INSERT INTO TIPO_VEHICULOS VALUES ('4','Coche');
INSERT INTO TIPO_VEHICULOS VALUES ('5','Vehículo pesado rígido ligero');
INSERT INTO TIPO_VEHICULOS VALUES ('6','Vehículo pesado rígido medio');
INSERT INTO TIPO_VEHICULOS VALUES ('7','Vehículo rígido pesado');
INSERT INTO TIPO_VEHICULOS VALUES ('8','Tractor');
INSERT INTO TIPO_VEHICULOS VALUES ('9','Vehículo en silla de ruedas');


CREATE TABLE TIPO_SERVICIOS 
(
  ID_TIPO_SERVICIO INTEGER NOT NULL 
, DESC_TIPO_SERVICIO VARCHAR2(120 BYTE) NOT NULL 
, CONSTRAINT TIPO_SERVICIO_PK PRIMARY KEY 
  (
    ID_TIPO_SERVICIO 
  )
)

INSERT INTO TIPO_SERVICIOS VALUES ('1','Fluido de transmisión automática');
INSERT INTO TIPO_SERVICIOS VALUES ('2','Batería y cables');
INSERT INTO TIPO_SERVICIOS VALUES ('3','Cinturones');
INSERT INTO TIPO_SERVICIOS VALUES ('4','Frenos');
INSERT INTO TIPO_SERVICIOS VALUES ('5','Filtro de aire de la cabina');
INSERT INTO TIPO_SERVICIOS VALUES ('6','Lubricación del chasis');
INSERT INTO TIPO_SERVICIOS VALUES ('7','Luz indicadora del tablero de instrumentos encendida');
INSERT INTO TIPO_SERVICIOS VALUES ('8','Refrigerante (anticongelante)');
INSERT INTO TIPO_SERVICIOS VALUES ('9','Filtro de aire del motor');
INSERT INTO TIPO_SERVICIOS VALUES ('10','Aceite de motor');
INSERT INTO TIPO_SERVICIOS VALUES ('11','Escape');
INSERT INTO TIPO_SERVICIOS VALUES ('12','Mangueras');
INSERT INTO TIPO_SERVICIOS VALUES ('13','Luces');
INSERT INTO TIPO_SERVICIOS VALUES ('14','Fluido de dirección asistida');
INSERT INTO TIPO_SERVICIOS VALUES ('15','Dirección y suspensión');
INSERT INTO TIPO_SERVICIOS VALUES ('16','Inflación y estado de los neumáticos');
INSERT INTO TIPO_SERVICIOS VALUES ('17','Alineación de rueda');
INSERT INTO TIPO_SERVICIOS VALUES ('18','Líquido lavaparabrisas');
INSERT INTO TIPO_SERVICIOS VALUES ('19','Limpiaparabrisas');


CREATE TABLE ESTADO_VEHICULOS 
(
  ID_ESTADO_VEH INTEGER NOT NULL 
, DESC_ESTADO_VEH VARCHAR2(120 BYTE) NOT NULL 
, CONSTRAINT ESTADO_VEHICULO_PK PRIMARY KEY 
  (
    ID_ESTADO_VEH 
  )
)

INSERT INTO ESTADO_VEHICULOS  VALUES ('1','Activo');
INSERT INTO ESTADO_VEHICULOS  VALUES ('2','Inactivo');
INSERT INTO ESTADO_VEHICULOS  VALUES ('3','Reparación');
INSERT INTO ESTADO_VEHICULOS  VALUES ('4','Vendido');


CREATE TABLE ESTADO_TIPO_SERVICIOS 
(
  ID_ESTADO_TIPO_SERVICIO INTEGER NOT NULL 
, DESC_TIPO_SERVICIO VARCHAR2(120 BYTE) NOT NULL 
, CONSTRAINT ESTADO_TIPO_SERVICIO_PK PRIMARY KEY 
  (
    ID_ESTADO_TIPO_SERVICIO 
  )
)


INSERT INTO ESTADO_TIPO_SERVICIOS VALUES ('1','Terminado');
INSERT INTO ESTADO_TIPO_SERVICIOS VALUES ('2','Programado');
INSERT INTO ESTADO_TIPO_SERVICIOS VALUES ('3','Reparacion');
INSERT INTO ESTADO_TIPO_SERVICIOS VALUES ('4','Observacion');

CREATE TABLE ESTADO_SERVCIOS 
(
  ID_ESTADO_SERVICIO INTEGER NOT NULL 
, DESC_ESTADO_SERVICIO VARCHAR2(120 BYTE) NOT NULL 
, CONSTRAINT ESTADO_SERVCIO_PK PRIMARY KEY 
  (
    ID_ESTADO_SERVICIO 
  )
)


INSERT INTO ESTADO_SERVCIOS VALUES ('1','Terminado');
INSERT INTO ESTADO_SERVCIOS VALUES ('2','Programado');
INSERT INTO ESTADO_SERVCIOS VALUES ('3','Pendiente');


CREATE TABLE CALIFICACION_CONDUCTORES 
(
  ID_CALIFICACION_COND INTEGER NOT NULL 
, CALIFICACION_COND VARCHAR2(120 BYTE) NOT NULL 
, CONSTRAINT CALIFICACION_CONDUCTOR_PK PRIMARY KEY 
  (
    ID_CALIFICACION_COND 
  )
)

INSERT INTO CALIFICACION_CONDUCTORES VALUES ('1','Activo');
INSERT INTO CALIFICACION_CONDUCTORES VALUES ('2','Inactivo');
INSERT INTO CALIFICACION_CONDUCTORES VALUES ('3','Expirado');
INSERT INTO CALIFICACION_CONDUCTORES VALUES ('4','Descalificado');


CREATE TABLE CONDUCTORES 
(
  ID_CONDUCTOR INTEGER NOT NULL 
, NOMBRE_COMPLETO_COND VARCHAR2(120 BYTE) NOT NULL 
, ID_CALIFICACION_COND INTEGER NOT NULL 
, CONSTRAINT CONDUCTORES_PK PRIMARY KEY 
  (
    ID_CONDUCTOR 
  )
)

ALTER TABLE CONDUCTORES
ADD CONSTRAINT CONDUCTORES_FK1 FOREIGN KEY
(
  ID_CALIFICACION_COND 
)
REFERENCES CALIFICACION_CONDUCTORES
(
  ID_CALIFICACION_COND 
)
ENABLE;

INSERT INTO CONDUCTORES VALUES ('1','Jordan Chase','1');
INSERT INTO CONDUCTORES VALUES ('2','Jaquelyn Bray','1');
INSERT INTO CONDUCTORES VALUES ('3','Malachi Vincent','1');
INSERT INTO CONDUCTORES VALUES ('4','Chelsea Abbott','1');
INSERT INTO CONDUCTORES VALUES ('5','Owen Conner','1');
INSERT INTO CONDUCTORES VALUES ('6','Rhona Battle','1');
INSERT INTO CONDUCTORES VALUES ('7','Jerry Rodriguez','1');
INSERT INTO CONDUCTORES VALUES ('8','Driscoll Bradley','1');
INSERT INTO CONDUCTORES VALUES ('9','Hiram England','1');
INSERT INTO CONDUCTORES VALUES ('10','Shay Wynn','1');
INSERT INTO CONDUCTORES VALUES ('11','Kyle Horne','1');
INSERT INTO CONDUCTORES VALUES ('12','Judah Waters','1');
INSERT INTO CONDUCTORES VALUES ('13','Brenda Wilkinson','1');
INSERT INTO CONDUCTORES VALUES ('14','Sade Dean','1');
INSERT INTO CONDUCTORES VALUES ('15','Orlando Alexander','1');
INSERT INTO CONDUCTORES VALUES ('16','Nora Thornton','1');
INSERT INTO CONDUCTORES VALUES ('17','Flavia Butler','1');
INSERT INTO CONDUCTORES VALUES ('18','Jordan Chase','1');
INSERT INTO CONDUCTORES VALUES ('19','Myles Reid','1');
INSERT INTO CONDUCTORES VALUES ('20','Xavier Roach','1');
INSERT INTO CONDUCTORES VALUES ('21','Melyssa Russell','1');
INSERT INTO CONDUCTORES VALUES ('22','Marah Graves','1');
INSERT INTO CONDUCTORES VALUES ('23','Shaeleigh Price','1');
INSERT INTO CONDUCTORES VALUES ('24','Frances Branch','1');
INSERT INTO CONDUCTORES VALUES ('25','Dylan Gibson','1');
INSERT INTO CONDUCTORES VALUES ('26','Hiroko Bradshaw','1');
INSERT INTO CONDUCTORES VALUES ('27','Sasha Jacobson','1');
INSERT INTO CONDUCTORES VALUES ('28','Samuel West','1');
INSERT INTO CONDUCTORES VALUES ('29','Sage Lang','1');
INSERT INTO CONDUCTORES VALUES ('30','George Joseph','1');
INSERT INTO CONDUCTORES VALUES ('31','Reuben Horne','1');
INSERT INTO CONDUCTORES VALUES ('32','Yoshi Hull','1');
INSERT INTO CONDUCTORES VALUES ('33','Lucy Brock','1');
INSERT INTO CONDUCTORES VALUES ('34','Roary Park','1');
INSERT INTO CONDUCTORES VALUES ('35','Giacomo Kirk','1');
INSERT INTO CONDUCTORES VALUES ('36','Camilla Bright','1');
INSERT INTO CONDUCTORES VALUES ('37','Carter Mercado','1');
INSERT INTO CONDUCTORES VALUES ('38','Jordan Rosales','1');
INSERT INTO CONDUCTORES VALUES ('39','Eve Moore','1');
INSERT INTO CONDUCTORES VALUES ('40','Cruz Sparks','1');
INSERT INTO CONDUCTORES VALUES ('41','Zoe Bolton','1');
INSERT INTO CONDUCTORES VALUES ('42','Dean Franklin','1');
INSERT INTO CONDUCTORES VALUES ('43','Kieran Guy','1');
INSERT INTO CONDUCTORES VALUES ('44','Sharon Whitehead','1');
INSERT INTO CONDUCTORES VALUES ('45','Nathan Santiago','1');
INSERT INTO CONDUCTORES VALUES ('46','Montana Sosa','1');
INSERT INTO CONDUCTORES VALUES ('47','Calvin Christian','1');
INSERT INTO CONDUCTORES VALUES ('48','Petra Travis','1');
INSERT INTO CONDUCTORES VALUES ('49','Phelan Hall','1');
INSERT INTO CONDUCTORES VALUES ('50','Alfonso Dean','1');


CREATE TABLE ASIGNACION_VEHICULOS 
(
  ID_ASIGNACION_VEH INTEGER NOT NULL 
, ID_VEHICULO INTEGER NOT NULL 
, ID_CONDUCTOR INTEGER NOT NULL 
, FECHA_ENTREGA_VEH DATE NOT NULL 
, FECHA_DEVOLUCION_VEH DATE 
, CONSTRAINT ASIGNACION_VEHICULO_PK PRIMARY KEY 
  (
    ID_ASIGNACION_VEH 
  )
  ENABLE 
) 

ALTER TABLE ASIGNACION_VEHICULOS
ADD CONSTRAINT ASIGNACION_VEHICULO_FK1 FOREIGN KEY
(
  ID_VEHICULO 

)
REFERENCES VEHICULOS
(
  ID_VEHICULO 

)
ENABLE;

ALTER TABLE ASIGNACION_VEHICULOS
ADD CONSTRAINT ASIGNACION_VEHICULO_FK2 FOREIGN KEY
(
  ID_CONDUCTOR 
)
REFERENCES CONDUCTORES
(
  ID_CONDUCTOR 
)
ENABLE;

CREATE TABLE VEHICULOS 
(
  ID_VEHICULO INTEGER NOT NULL 
, DESC_VEH VARCHAR2(120 BYTE) NOT NULL 
, PLACA VARCHAR2(20 BYTE) NOT NULL 
, KILOMETRAJE NUMBER NOT NULL 
, ID_ESTADO_VEH INTEGER NOT NULL 
, ID_TIPO_VEH INTEGER NOT NULL 
, MODELO_AÑO_VEH VARCHAR2(20 BYTE) NOT NULL 
, FECHA_COMPRA_VEH DATE NOT NULL 
, VALOR_ACTUAL DECIMAL NOT NULL 
, VALOR_DE_REEMPLAZO DECIMAL NOT NULL 
, CONSTRAINT VEHICLES_PK PRIMARY KEY 
  (
    ID_VEHICULO 
  )
)

ALTER TABLE VEHICULOS
ADD CONSTRAINT VEHICULOS_FK1 FOREIGN KEY
(
  ID_ESTADO_VEH 
)
REFERENCES ESTADO_VEHICULOS
(
  ID_ESTADO_VEH 
)
ENABLE;

ALTER TABLE VEHICULOS
ADD CONSTRAINT VEHICULOS_FK2 FOREIGN KEY
(
  ID_TIPO_VEH 
)
REFERENCES TIPO_VEHICULOS
(
  ID_TIPO_VEH 
)
ENABLE;

INSERT INTO VEHICULOS VALUES ('1','AKT GT','KHV12W','5000','1','2','2017','01102017','57000000','57000000');
INSERT INTO VEHICULOS VALUES ('2','AVEO','WER123','4350','1','4','2010','20112010','8900000','8900000');
INSERT INTO VEHICULOS VALUES ('3','CERATO','FDS123','9094','1','4','2016','09062016','45000000','45000000');
INSERT INTO VEHICULOS VALUES ('4','ACCENT','WTR432','90943','1','4','2015','20122015','8900000','8900000');
INSERT INTO VEHICULOS VALUES ('5','CERATO 2','QWE345','10002','1','4','2015','20122015','54322000','54322000');
INSERT INTO VEHICULOS VALUES ('6','PULSAR 200','FGD23Q','33222','1','3','2014','02042014','60000990','60000990');
INSERT INTO VEHICULOS VALUES ('7','HYUNDAI','GHD456','22334','1','5','2014','02042014','23000000','23000000');
INSERT INTO VEHICULOS VALUES ('8','LINK BELT','KJH765','76543','1','6','2013','03302013','12000000','12000000');
INSERT INTO VEHICULOS VALUES ('9','HELL','HYT357','9000','1','7','2016','20082016','45000000','45000000');
INSERT INTO VEHICULOS VALUES ('10','SIMCA','DFS099','12897','1','7','2015','15072016','45333000','45333000');
INSERT INTO VEHICULOS VALUES ('11','DAF','RTT443','20134','1','6','2016','23062016','54000000','54000000');
INSERT INTO VEHICULOS VALUES ('12','IVECO','HYU321','19009','1','6','2016','23062016','54900000','54900000');
INSERT INTO VEHICULOS VALUES ('13','ISUZU','KJJ675','18554','1','5','2016','23062016','34200000','34200000');
INSERT INTO VEHICULOS VALUES ('14','CAT','LLK554','8985','1','5','2016','23062016','67000000','67000000');
INSERT INTO VEHICULOS VALUES ('15','PERKIN','LLO345','6750','1','5','2015','20122015','76540000','76540000');
INSERT INTO VEHICULOS VALUES ('16','HONDA 125','EWR13A','23456','1','2','2016','23062016','34000000','34000000');
INSERT INTO VEHICULOS VALUES ('17','SCANIA','GJT459','32145','1','6','2013','02032013','18000000','18000000');
INSERT INTO VEHICULOS VALUES ('18','IVECO','FDS457','7654','1','6','2017','01102017','67000000','67000000');
INSERT INTO VEHICULOS VALUES ('19','HYUNDAI','LEW123','90776','2','5','2011','01012011','27000000','27000000');
INSERT INTO VEHICULOS VALUES ('20','IVECO','KFD332','1253','1','5','2017','01102017','67000000','67000000');


CREATE TABLE SERVICIOS 
(
  ID_SERVICIO INTEGER NOT NULL 
, ID_TIPO_SERVICIO INTEGER NOT NULL 
, ID_ESTADO_SERVICIO INTEGER NOT NULL 
, ID_VEHICULO INTEGER NOT NULL 
, ID_ESTADO_TIPO_SERVICIO NUMBER(*, 0) NOT NULL 
, FECHA_EMISION DATE NOT NULL 
, DESC_SERVICIO VARCHAR2(120 BYTE) NOT NULL 
, CONSTRAINT SERVICIO_PK PRIMARY KEY 
  (
    ID_SERVICIO 
  )
)

ALTER TABLE SERVICIOS
ADD CONSTRAINT SERVICIOS_FK1 FOREIGN KEY
(
  ID_ESTADO_TIPO_SERVICIO 
)
REFERENCES ESTADO_TIPO_SERVICIOS
(
  ID_ESTADO_TIPO_SERVICIO 
)
ENABLE;

ALTER TABLE SERVICIOS
ADD CONSTRAINT SERVICIO_FK1 FOREIGN KEY
(
  ID_VEHICULO 
)
REFERENCES VEHICULOS
(
  ID_VEHICULO 
)
ENABLE;

ALTER TABLE SERVICIOS
ADD CONSTRAINT SERVICIO_FK2 FOREIGN KEY
(
  ID_TIPO_SERVICIO 
)
REFERENCES TIPO_SERVICIOS
(
  ID_TIPO_SERVICIO 
)
ENABLE;

ALTER TABLE SERVICIOS
ADD CONSTRAINT SERVICIO_FK3 FOREIGN KEY
(
  ID_ESTADO_SERVICIO 
)
REFERENCES ESTADO_SERVCIOS
(
  ID_ESTADO_SERVICIO 
)
ENABLE;

INSERT INTO SERVICIOS VALUES ('1','1','1','2','3','01012017','revision');
INSERT INTO SERVICIOS VALUES ('2','2','1','3','3','02032017','reparacion');
INSERT INTO SERVICIOS VALUES ('3','3','1','3','2','04042017','cambio');
INSERT INTO SERVICIOS VALUES ('4','4','1','5','2','06042017','revision');
INSERT INTO SERVICIOS VALUES ('5','3','1','5','1','06042017','revision');
INSERT INTO SERVICIOS VALUES ('6','2','1','6','1','08042017','cambio');
INSERT INTO SERVICIOS VALUES ('7','1','1','7','1','01052017','cambio');


CREATE TABLE ESTADO_VALORES_A_PAGAR 
(
  ID_ESTADO_VALOR_A_PAGAR INTEGER NOT NULL 
, DESC_ESTADO_VALOR_A_PAGAR VARCHAR2(120 BYTE) NOT NULL 
, CONSTRAINT ESTADO_VALORES_A_PAGAR_PK PRIMARY KEY 
  (
    ID_ESTADO_VALOR_A_PAGAR 
  )
)
INSERT INTO ESTADO_VALORES_A_PAGAR VALUES ('1','Pagado');
INSERT INTO ESTADO_VALORES_A_PAGAR VALUES ('2','Pendiente');

CREATE TABLE TIPO_RECLAMO_SEGUROS 
(
  ID_TIPO_RECLAMO_SEGURO INTEGER NOT NULL 
, DESC_TIPO_RECLAMO_SEGURO VARCHAR2(120 BYTE) NOT NULL 
, CONSTRAINT TIPO_RECLAMO_SEGURO_PK PRIMARY KEY 
  (
    ID_TIPO_RECLAMO_SEGURO 
  )
)
INSERT INTO TIPO_RECLAMO_SEGUROS VALUES ('1','Accidente');
INSERT INTO TIPO_RECLAMO_SEGUROS VALUES ('2','Incidente');

CREATE TABLE RECLAMOS_SEGUROS 
(
  ID_RECLAMO_SEGURO INTEGER NOT NULL 
, POLIZA VARCHAR2(120 BYTE) NOT NULL 
, FECHA_PERDIDA DATE NOT NULL 
, FECHA_EMISION DATE NOT NULL 
, VALOR_A_PAGAR INTEGER NOT NULL 
, ID_ESTADO_VALOR_A_PAGAR INTEGER NOT NULL 
, ID_TIPO_RECLAMO_SEGURO INTEGER NOT NULL 
, ID_VEHICULO INTEGER NOT NULL 
, NATURALEZA_DEL_PAGO VARCHAR2(120 BYTE) 
, DAÑOS_Y_PREJUICIOS VARCHAR2(120 BYTE) 
, CONSTRAINT RECLAMOS_SEGUROS_PK PRIMARY KEY 
  (
    ID_RECLAMO_SEGURO 
  )
)

ALTER TABLE RECLAMOS_SEGUROS
ADD CONSTRAINT RECLAMOS_SEGUROS_FK1 FOREIGN KEY
(
  ID_VEHICULO 
)
REFERENCES VEHICULOS
(
  ID_VEHICULO 
)
ENABLE;

ALTER TABLE RECLAMOS_SEGUROS
ADD CONSTRAINT RECLAMOS_SEGUROS_FK2 FOREIGN KEY
(
  ID_ESTADO_VALOR_A_PAGAR 
)
REFERENCES ESTADO_VALORES_A_PAGAR
(
  ID_ESTADO_VALOR_A_PAGAR 
)
ENABLE;

ALTER TABLE RECLAMOS_SEGUROS
ADD CONSTRAINT RECLAMOS_SEGUROS_FK3 FOREIGN KEY
(
  ID_TIPO_RECLAMO_SEGURO 
)
REFERENCES TIPO_RECLAMO_SEGUROS
(
  ID_TIPO_RECLAMO_SEGURO 
)
ENABLE;

INSERT INTO RECLAMOS_SEGUROS VALUES ('1','1000','28022017','04032017','0','2','2','2','','');
INSERT INTO RECLAMOS_SEGUROS VALUES ('2','1001','10032017','15032017','0','2','2','4','','');
INSERT INTO RECLAMOS_SEGUROS VALUES ('3','1002','10032017','15032017','1200000','1','1','6','lesiones','terceros');
INSERT INTO RECLAMOS_SEGUROS VALUES ('4','1003','12032017','17032017','0','2','2','1','','');
INSERT INTO RECLAMOS_SEGUROS VALUES ('5','1004','17032017','22032017','0','2','2','3','','');
INSERT INTO RECLAMOS_SEGUROS VALUES ('6','1005','24032017','29032017','0','2','2','5','','');
INSERT INTO RECLAMOS_SEGUROS VALUES ('7','1006','27032017','01042017','5000000','2','1','9','lesiones','terceros');
INSERT INTO RECLAMOS_SEGUROS VALUES ('8','1007','01042017','06042017','4500000','2','1','12','lesiones','terceros');
INSERT INTO RECLAMOS_SEGUROS VALUES ('9','1008','19042017','24042017','3000000','2','1','11','lesiones','terceros');
INSERT INTO RECLAMOS_SEGUROS VALUES ('10','1009','24042017','29042017','1500000','2','1','10','lesiones','terceros');


create or replace FUNCTION service(kilometraje int)
return varchar
is
name varchar(30);
BEGIN
name := kilometraje||'_service';
return name;
END;

DECLARE
cursor cursor1 is select kilometraje from VEHICULOS;
BEGIN
for vehiculo IN cursor1
LOOP
dbms_output.put_line(service(vehiculo.kilometraje));
END LOOP;

END;

create or replace procedure proc_vehicule(id in numeric)
is
cursor cursor1 is select ID_VEHICULO,kilometraje from VEHICULOS;
servicename varchar(30);
ID_SERV int;
id_veh int;
BEGIN
 select count(*) into id_serv from servicios;
for vehiculo IN cursor1
LOOP
id_veh:= service(vehiculo.id_vehiculo);
servicename:=service(vehiculo.kilometraje);

if servicename=null then
    dbms_output.put_line('No service name');
else
    if id_veh = id then  
    
    insert into SERVICIOS (id_servicio,id_tipo_servicio,id_estado_servicio,id_vehiculo,id_estado_tipo_servicio, fecha_emision,desc_servicio)values
    (id_serv+1,3,1,id,2,current_date,'Mandatory'||servicename||'service;'||'current mileage'||9123);

    end if;
end if;
END LOOP;

end;

create or replace trigger updatekilometer
after update of kilometraje on vehiculos
for each row
begin

  proc_vehicule(2);

end;


